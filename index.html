<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DecoraJLP | Design e Conforto</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <nav class="navbar">
            <div class="logo" onclick="app.navTo('home')"><i class="fas fa-chair"></i> DecoraJLP</div>
            <ul class="nav-menu">
                <li><a onclick="app.navTo('home')">Início</a></li>
                <li><a onclick="app.navTo('catalog')">Catálogo</a></li>
                <li><a onclick="app.navTo('contact')">Contato</a></li>
            </ul>
            <div class="nav-actions">
                <div id="user-area"><button class="btn btn-primary" onclick="app.navTo('login')">Entrar</button></div>
                <div class="cart-widget" onclick="app.navTo('cart')">
                    <i class="fas fa-shopping-cart"></i>
                    <span id="cart-badge" class="badge">0</span>
                </div>
            </div>
        </nav>
    </header>

    <main>
        <section id="home" class="page-view active">
            <div class="hero">
                <h1>Design Exclusivo para seu Lar</h1>
                <button class="btn btn-outline" style="color: white; border-color: white; margin-top: 1rem;" onclick="app.navTo('catalog')">Ver Coleção</button>
            </div>
            <h2 style="text-align: center; margin: 1.5rem 0; color: var(--primary-blue);">Destaques DecoraJLP</h2>
            <div id="featured-grid" class="products-grid"></div>
        </section>

        <section id="catalog" class="page-view">
            <h2 style="margin-bottom: 1rem;">Catálogo Completo</h2>
            <div id="catalog-grid" class="products-grid"></div>
        </section>

        <section id="product-detail" class="page-view">
            <button class="btn btn-outline" onclick="app.navTo('catalog')" style="margin-bottom: 1rem;">← Voltar</button>
            <div id="detail-content" class="product-detail-container"></div>
        </section>

        <section id="cart" class="page-view">
            <h2>Seu Carrinho</h2>
            <div id="cart-list" style="margin: 1rem 0;"></div>
            <div style="text-align: right; font-size: 1.5rem; font-weight: bold;">Total: <span id="cart-total">R$ 0,00</span></div>
            <div style="text-align: right; margin-top: 1rem;"><button class="btn btn-primary" onclick="app.checkCheckout()">Ir para Pagamento</button></div>
        </section>

        <section id="checkout" class="page-view">
            <h2>Finalizar Pedido</h2>
            <div class="checkout-layout">
                <div class="form-box">
                    <h3>Endereço & Frete</h3>
                    <div class="form-group">
                        <label>Estado de Entrega</label>
                        <select id="freight-state" onchange="app.calcFreight()">
                            <option value="">Selecione...</option>
                            <option value="SP">SP (Grátis)</option>
                            <option value="RJ">Rio de Janeiro (R$ 49,90)</option>
                            <option value="OUTROS">Outros Estados (R$ 119,90)</option>
                        </select>
                    </div>
                    <div class="form-group"><label>CEP</label><input type="text" placeholder="00000-000"></div>
                    <div class="form-group"><label>Rua</label><input type="text"></div>
                    <p>Frete: <strong id="freight-value">R$ 0,00</strong></p>
                </div>
                <div class="form-box">
                    <h3>Pagamento</h3>
                    <div style="margin-bottom: 1rem;">
                        <div class="payment-opt" onclick="app.selectPayment(this)">
                            <i class="fas fa-qrcode"></i> PIX
                        </div>
                        <div class="payment-opt" onclick="app.selectPayment(this)">
                            <i class="fas fa-credit-card"></i> Cartão de Crédito
                        </div>
                        <div class="payment-opt" onclick="app.selectPayment(this)">
                            <i class="fas fa-barcode"></i> Boleto Bancário
                        </div>
                    </div>
                    <div style="margin-top: 1rem; border-top: 1px solid #ddd; padding-top: 1rem;">
                        <h3>Total Final: <span id="final-total">R$ 0,00</span></h3>
                        <button class="btn btn-primary" style="width: 100%; margin-top: 1rem;" onclick="app.finishOrder()">Confirmar Compra</button>
                    </div>
                </div>
            </div>
        </section>

        <section id="login" class="page-view">
            <div class="auth-container">
                <div class="auth-tabs">
                    <button class="auth-tab active" onclick="app.toggleAuth('login')">Entrar</button>
                    <button class="auth-tab" onclick="app.toggleAuth('register')">Criar Conta</button>
                </div>
                <div id="login-form" class="auth-form active">
                    <div class="form-group"><label>E-mail</label><input type="email" id="login-email"></div>
                    <div class="form-group"><label>Senha</label><input type="password" id="login-pass"></div>
                    <button class="btn btn-primary" style="width: 100%;" onclick="app.login()">Acessar</button>
                </div>
                <div id="register-form" class="auth-form">
                    <div class="form-group"><label>Nome</label><input type="text" id="reg-name"></div>
                    <div class="form-group"><label>CPF</label><input type="text" id="reg-cpf"></div>
                    <div class="form-group"><label>E-mail</label><input type="email" id="reg-email"></div>
                    <div class="form-group"><label>Senha</label><input type="password" id="reg-pass"></div>
                    <button class="btn btn-primary" style="width: 100%;" onclick="app.register()">Cadastrar</button>
                </div>
            </div>
        </section>
        
        <section id="contact" class="page-view">
            <div class="auth-container">
                <h2>Fale Conosco</h2>
                <div class="form-group"><label>Nome</label><input type="text"></div>
                <div class="form-group"><label>Mensagem</label><input type="text" style="height: 100px;"></div>
                <button class="btn btn-primary">Enviar</button>
            </div>
        </section>
    </main>

    <footer>
        <div class="footer-content">
            <div class="footer-col">
                <div class="logo" style="color: white; margin-bottom: 1rem;"><i class="fas fa-chair" style="color: var(--accent-red);"></i> DecoraJLP</div>
                <p>Sua casa merece o melhor do design.</p>
            </div>
            <div class="footer-col">
                <h3>Contato</h3>
                <p>Av. Paulista, 1234 - SP</p>
                <p>(11) 1223-4567</p>
                <p>sac@decorajlp.com</p>
            </div>
        </div>
        <div class="footer-bottom"><p>&copy; 2024 DecoraJLP. CNPJ: 45.123.678/0001-99</p></div>
    </footer>

    <script>
        const db = { products: [], cart: [], user: null };
        const app = {
            init: async function() {
                await this.loadProducts();
                this.renderFeatured();
                this.renderCatalog();
            },
            loadProducts: async function() {
                try {
                    const res = await fetch('buscar_produtos.php');
                    db.products = await res.json();
                } catch (err) {
                    console.error("Erro:", err);
                    alert("Erro ao carregar produtos. Verifique se o XAMPP está rodando.");
                }
            },
            navTo: function(id) {
                document.querySelectorAll('.page-view').forEach(p => p.classList.remove('active'));
                document.getElementById(id).classList.add('active');
            },
            toggleAuth: function(mode) {
                document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
                if (mode === 'login') {
                    document.querySelectorAll('.auth-tab')[0].classList.add('active');
                    document.getElementById('login-form').classList.add('active');
                } else {
                    document.querySelectorAll('.auth-tab')[1].classList.add('active');
                    document.getElementById('register-form').classList.add('active');
                }
            },
            renderFeatured: function() {
                const grid = document.getElementById('featured-grid');
                if(db.products.length < 3) return;
                grid.innerHTML = [db.products[0], db.products[1], db.products[2]].map(p => this.createCard(p, true)).join('');
            },
            renderCatalog: function() {
                document.getElementById('catalog-grid').innerHTML = db.products.map(p => this.createCard(p)).join('');
            },
            createCard: function(p, destaque = false) {
                return `<div class="product-card" onclick="app.viewProduct(${p.id})">
                    ${destaque ? '<span class="badge-destaque">Destaque</span>' : ''}
                    <img src="${p.img}" class="card-img">
                    <div class="card-body">
                        <h3>${p.nome}</h3>
                        <div class="price-tag">R$ ${parseFloat(p.preco).toFixed(2).replace('.', ',')}</div>
                        <button class="btn btn-primary" onclick="event.stopPropagation(); app.addToCart(${p.id})">Adicionar</button>
                    </div>
                </div>`;
            },
            viewProduct: function(id) {
                const p = db.products.find(i => i.id == id);
                document.getElementById('detail-content').innerHTML = `
                    <img src="${p.img}" class="detail-img">
                    <div>
                        <h2 style="color:var(--primary-blue)">${p.nome}</h2>
                        <p style="margin: 1rem 0; line-height: 1.6;">${p.descr || 'Sem descrição disponível.'}</p>
                        <h3>R$ ${parseFloat(p.preco).toFixed(2).replace('.', ',')}</h3>
                        <button class="btn btn-primary" onclick="app.addToCart(${p.id})" style="margin-top: 1rem;">Adicionar ao Carrinho</button>
                    </div>`;
                this.navTo('product-detail');
            },
            addToCart: function(id) {
                db.cart.push(db.products.find(i => i.id == id));
                document.getElementById('cart-badge').innerText = db.cart.length;
                this.renderCart();
                alert("Produto adicionado ao carrinho!");
            },
            renderCart: function() {
                const list = document.getElementById('cart-list');
                let total = 0;
                if(db.cart.length === 0) list.innerHTML = "<p>Seu carrinho está vazio.</p>";
                else {
                    list.innerHTML = db.cart.map((item, i) => {
                        total += parseFloat(item.preco);
                        return `<div class="cart-item">
                            <strong>${item.nome}</strong>
                            <span>R$ ${parseFloat(item.preco).toFixed(2).replace('.', ',')}</span>
                            <button onclick="app.removeFromCart(${i})" style="color:red;border:none;background:none;cursor:pointer;"><i class="fas fa-trash"></i></button>
                        </div>`;
                    }).join('');
                }
                document.getElementById('cart-total').innerText = `R$ ${total.toFixed(2).replace('.', ',')}`;
                this.calcFreight();
            },
            removeFromCart: function(i) {
                db.cart.splice(i, 1);
                document.getElementById('cart-badge').innerText = db.cart.length;
                this.renderCart();
            },
            checkCheckout: function() {
                if(db.cart.length === 0) return alert("Seu carrinho está vazio!");
                if(!db.user) { 
                    alert("Você precisa fazer login para finalizar a compra."); 
                    return this.navTo('login'); 
                }
                this.navTo('checkout');
            },
            calcFreight: function() {
                const val = document.getElementById('freight-state').value;
                let cost = (val === 'SP') ? 0 : (val === 'RJ' ? 49.90 : 119.90);
                let total = db.cart.reduce((a,b) => a + parseFloat(b.preco), 0);
                if(val === "") cost = 0;
                document.getElementById('freight-value').innerText = `R$ ${cost.toFixed(2).replace('.', ',')}`;
                document.getElementById('final-total').innerText = `R$ ${(total + cost).toFixed(2).replace('.', ',')}`;
            },
            selectPayment: function(element) {
                document.querySelectorAll('.payment-opt').forEach(el => el.classList.remove('selected'));
                element.classList.add('selected');
            },
            login: async function() {
                const email = document.getElementById('login-email').value;
                const pass = document.getElementById('login-pass').value;
                if(!email || !pass) return alert("Preencha todos os campos.");
                
                const res = await fetch('auth.php', { method:'POST', body:JSON.stringify({acao:'login', email, senha:pass}) });
                const data = await res.json();
                
                if(data.sucesso) {
                    db.user = data.usuario;
                    document.getElementById('user-area').innerHTML = `Olá, <b>${data.usuario.nome}</b>`;
                    alert("Login realizado com sucesso!");
                    this.navTo('home');
                } else { alert(data.msg); }
            },
            register: async function() {
                const nome = document.getElementById('reg-name').value;
                const cpf = document.getElementById('reg-cpf').value;
                const email = document.getElementById('reg-email').value;
                const pass = document.getElementById('reg-pass').value;
                
                if(!nome || !cpf || !email || !pass) return alert("Preencha todos os campos.");

                const res = await fetch('auth.php', { method:'POST', body:JSON.stringify({acao:'cadastro', nome, email, senha:pass, cpf}) });
                const data = await res.json();
                
                if(data.sucesso) {
                    db.user = data.usuario;
                    document.getElementById('user-area').innerHTML = `Olá, <b>${data.usuario.nome}</b>`;
                    alert("Cadastro realizado com sucesso!");
                    this.navTo('home');
                } else { alert(data.msg); }
            },
            finishOrder: async function() {
                const totalText = document.getElementById('final-total').innerText;
                const total = parseFloat(totalText.replace('R$ ','').replace('.','').replace(',','.'));
                
                const res = await fetch('salvar_pedido.php', { method:'POST', body:JSON.stringify({usuario_id:db.user.id, total}) });
                const data = await res.json();
                
                if(data.sucesso) {
                    alert("Pedido realizado com sucesso! Obrigado pela compra.");
                    db.cart = [];
                    location.reload();
                } else { alert("Erro ao salvar o pedido: " + (data.msg || "Erro desconhecido")); }
            }
        };
        window.onload = () => app.init();
    </script>
</body>
</html>